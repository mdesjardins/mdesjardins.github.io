<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Mike Desjardins">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="dcterms.date" content="2010-10-03" />
  <title>Using Apache Velocity with Android</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: 1;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="/style.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=VT323&display=swap" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="container">
<div class="content">
<header id="title-block-header">
<h1 class="title">Using Apache Velocity with Android</h1>
<p class="date">2010-10-03</p>
</header>
<article>
<p>I’m working on an Android project right now where I plan on using a
WebView to display some content, and I need to generate that content
dynamically based on the results of a web service request. I wanted an
easy-to-use templating language to build the pages with. I’ve worked
with both
<a href="http://velocity.apache.org/" target="_blank">Velocity</a> and
<a href="http://freemarker.sourceforge.net/" target="_blank">Freemarker</a>,
and either would’ve been fine. I settled on Velocity because it was a
bit easier to set up to work with Android. Here’s how I did it.</p>
<h1 id="setup-logging">Setup Logging</h1>
<p>First, I wanted to setup Velocity to use Android’s built-in logging
system. To do that, I needed to create my own logging class that
implemented the LogChute interface.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> com</span><span class="op">.</span><span class="im">cereslogic</span><span class="op">.</span><span class="im">velocity</span><span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">velocity</span><span class="op">.</span><span class="im">runtime</span><span class="op">.</span><span class="im">RuntimeServices</span><span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">velocity</span><span class="op">.</span><span class="im">runtime</span><span class="op">.</span><span class="im">log</span><span class="op">.</span><span class="im">LogChute</span><span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">android</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">Log</span><span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> VelocityLogger <span class="kw">implements</span> LogChute <span class="op">{</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">static</span> <span class="bu">String</span> tag <span class="op">=</span> <span class="st">&quot;Velocity&quot;</span><span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">init</span><span class="op">(</span>RuntimeServices arg0<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isLevelEnabled</span><span class="op">(</span><span class="dt">int</span> level<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> level <span class="op">&amp;</span>gt<span class="op">;</span> LogChute<span class="op">.</span><span class="fu">DEBUG_ID</span><span class="op">;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">log</span><span class="op">(</span><span class="dt">int</span> level<span class="op">,</span> <span class="bu">String</span> msg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span><span class="op">(</span>level<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> LogChute<span class="op">.</span><span class="fu">DEBUG_ID</span><span class="op">:</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">d</span><span class="op">(</span>tag<span class="op">,</span>msg<span class="op">);</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> LogChute<span class="op">.</span><span class="fu">ERROR_ID</span><span class="op">:</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">e</span><span class="op">(</span>tag<span class="op">,</span>msg<span class="op">);</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> LogChute<span class="op">.</span><span class="fu">INFO_ID</span><span class="op">:</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">i</span><span class="op">(</span>tag<span class="op">,</span>msg<span class="op">);</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> LogChute<span class="op">.</span><span class="fu">TRACE_ID</span><span class="op">:</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">d</span><span class="op">(</span>tag<span class="op">,</span>msg<span class="op">);</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> LogChute<span class="op">.</span><span class="fu">WARN_ID</span><span class="op">:</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">w</span><span class="op">(</span>tag<span class="op">,</span>msg<span class="op">);</span> </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>       <span class="op">}</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">log</span><span class="op">(</span><span class="dt">int</span> level<span class="op">,</span> <span class="bu">String</span> msg<span class="op">,</span> <span class="bu">Throwable</span> t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span><span class="op">(</span>level<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> LogChute<span class="op">.</span><span class="fu">DEBUG_ID</span><span class="op">:</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">d</span><span class="op">(</span>tag<span class="op">,</span>msg<span class="op">,</span>t<span class="op">);</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> LogChute<span class="op">.</span><span class="fu">ERROR_ID</span><span class="op">:</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">e</span><span class="op">(</span>tag<span class="op">,</span>msg<span class="op">,</span>t<span class="op">);</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> LogChute<span class="op">.</span><span class="fu">INFO_ID</span><span class="op">:</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">i</span><span class="op">(</span>tag<span class="op">,</span>msg<span class="op">,</span>t<span class="op">);</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> LogChute<span class="op">.</span><span class="fu">TRACE_ID</span><span class="op">:</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">d</span><span class="op">(</span>tag<span class="op">,</span>msg<span class="op">,</span>t<span class="op">);</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> LogChute<span class="op">.</span><span class="fu">WARN_ID</span><span class="op">:</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>            Log<span class="op">.</span><span class="fu">w</span><span class="op">(</span>tag<span class="op">,</span>msg<span class="op">,</span>t<span class="op">);</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>You can obviously adjust the <strong>isLevelEnabled</strong> method
for your desired logging level.</p>
<h1 id="create-a-resourceloader">Create a ResourceLoader</h1>
<p>Next I need to feed my templates to Velocity. I could have read my
templates manually as files from the assets directory, then passed the
contents of the templates file to Velocity.evaluate as a String. But
Velocity has a very configurable way to process templates that, enables
it to cache templates internally, so I decided to try that.</p>
<p>When passing Velocity the name of a template file, it delegates the
template loading to a ResourceLoader class. When you initialize
Velocity, you can configure which ResourceLoaders it should use to find
and read your templates.  Later. when you call the
<strong>getTemplate</strong> method of the Velocity helper class, you
pass it the name of the template that you’d like to load as a String.
Velocity will pass the resource name down to its ResourceLoader(s).</p>
<p>I wanted to store my Velocity templates in the raw subdirectory of
the res directory in the Android project, so I needed to build a
ResourceLoader that could do that. I decided to extend Velocity’s
built-in FileResourceLoader as a starting point. Here’s what I came up
with:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">package</span><span class="im"> com</span><span class="op">.</span><span class="im">cereslogic</span><span class="op">.</span><span class="im">velocity</span><span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">InputStream</span><span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">commons</span><span class="op">.</span><span class="im">collections</span><span class="op">.</span><span class="im">ExtendedProperties</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">velocity</span><span class="op">.</span><span class="im">runtime</span><span class="op">.</span><span class="im">RuntimeServices</span><span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">velocity</span><span class="op">.</span><span class="im">runtime</span><span class="op">.</span><span class="im">resource</span><span class="op">.</span><span class="im">Resource</span><span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">apache</span><span class="op">.</span><span class="im">velocity</span><span class="op">.</span><span class="im">runtime</span><span class="op">.</span><span class="im">resource</span><span class="op">.</span><span class="im">loader</span><span class="op">.</span><span class="im">FileResourceLoader</span><span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">import</span> <span class="im">android</span><span class="op">.</span><span class="im">content</span><span class="op">.</span><span class="im">res</span><span class="op">.</span><span class="im">Resources</span><span class="op">;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">class</span> AndroidResourceLoader <span class="kw">extends</span> FileResourceLoader <span class="op">{</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="bu">Resources</span> resources<span class="op">;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="bu">String</span> packageName<span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">commonInit</span><span class="op">(</span>RuntimeServices rs<span class="op">,</span> ExtendedProperties configuration<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">super</span><span class="op">.</span><span class="fu">commonInit</span><span class="op">(</span>rs<span class="op">,</span>configuration<span class="op">);</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">resources</span> <span class="op">=</span> <span class="op">(</span><span class="bu">Resources</span><span class="op">)</span>rs<span class="op">.</span><span class="fu">getProperty</span><span class="op">(</span><span class="st">&quot;android.content.res.Resources&quot;</span><span class="op">);</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">packageName</span> <span class="op">=</span> <span class="op">(</span><span class="bu">String</span><span class="op">)</span>rs<span class="op">.</span><span class="fu">getProperty</span><span class="op">(</span><span class="st">&quot;packageName&quot;</span><span class="op">);</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">long</span> <span class="fu">getLastModified</span><span class="op">(</span><span class="bu">Resource</span> resource<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="bu">InputStream</span> <span class="fu">getResourceStream</span><span class="op">(</span><span class="bu">String</span> templateName<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> id <span class="op">=</span> resources<span class="op">.</span><span class="fu">getIdentifier</span><span class="op">(</span>templateName<span class="op">,</span> <span class="st">&quot;raw&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">packageName</span><span class="op">);</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> resources<span class="op">.</span><span class="fu">openRawResource</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">boolean</span>  <span class="fu">isSourceModified</span><span class="op">(</span><span class="bu">Resource</span> resource<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">boolean</span>  <span class="fu">resourceExists</span><span class="op">(</span><span class="bu">String</span> templateName<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> resources<span class="op">.</span><span class="fu">getIdentifier</span><span class="op">(</span>templateName<span class="op">,</span> <span class="st">&quot;raw&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">packageName</span><span class="op">)</span> <span class="op">!=</span> <span class="op">;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>Because the templates are statically bundled with the .apk file, we
can assume that Velocity’s caches don’t need to concern themselves with
modification times on the templates, which is why
<strong>getLastModified</strong> and <strong>isSourceModified</strong>
don’t really do anything.  The <strong>getResourceStream</strong> and
<strong>resourceExists</strong> methods lookup the resource ID by name.
The <strong>commonInit</strong> method is called when the
ResourceManager initializes the ResourceLoader. You’ll notice that this
is where we stash the package name for the resources as well as an
instance of the Resource class.</p>
<h2 id="use-it">Use It</h2>
<p>So to use what we just created, we need to do some configuration
before we call Velocity.init(), which will look something like this:</p>
<pre><code>    public class MyActivity extends Activity {
      private void setupVelocity() throws Exception {
            Velocity.setProperty(Velocity.RUNTIME_LOG_LOGSYSTEM_CLASS, &quot;com.cereslogic.velocity.VelocityLogger&quot;);
            Velocity.setProperty(&quot;resource.loader&quot;, &quot;android&quot;);
            Velocity.setProperty(&quot;android.resource.loader.class&quot;, &quot;com.cereslogic.velocity.AndroidResourceLoader&quot;);
            Velocity.setProperty(&quot;android.content.res.Resources&quot;,getResources());
            Velocity.setProperty(&quot;packageName&quot;, &quot;com.cereslogic.myapplication&quot;);
            Velocity.init();
      }
    .
    .
    .
    //
    // Somewhere where we want to use velocity:
    //
        WebView engine = (WebView) findViewById(R.id.web_engine);
        Template template = null;
        try {
            setupVelocity();
            VelocityContext context = new VelocityContext();
            // add stuff to your context.
            template = Velocity.getTemplate(&quot;mytemplate&quot;);
            StringWriter sw = new StringWriter();
            template.merge(context, sw);
            engine.loadData(sw.toString(), &quot;text/html&quot;, &quot;UTF-8&quot;);
        } catch (Exception e) {
            // deal with it.
        }</code></pre>
<p>In the <strong>setupVelocity</strong> method, we need to configure
Velocity to use our new ResourceLoader and Logging classes, and
configure the package name for our resources, just before calling
Velocity <strong>init</strong>. Note that, if you name your template
mytemplate.vm, you’ll only pass mytemplate to the Velocity
<strong>getTemplate</strong> method. This is because of the
idiosyncratic way that Android’s named resource lookup stuff works.</p>
<p>Now you’re ready to use Velocity in your Android project!</p>
</article>
</div>
<nav>
&#x25c4 <a href="2010-10-25-skicast-1-0-released.html" rel="next">Skicast
Android Application Released</a>
<a href="2009-10-26-new-site.html" rel="prev">New Site</a> &#x25ba
</nav>
<div class="license">
<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a>
<br />
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">
Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.
</div>
</div>
</div>
</body>
</html>
